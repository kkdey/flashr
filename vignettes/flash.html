<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="author" content="Wei Wang &lt;weidong@uchicago.edu&gt;, Matthew Stephens &lt;mstephens@uchicago.edu&gt;" />

<meta name="date" content="2016-03-25" />

<title>flash</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0A%7D%0Apre%20%7B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>



<div id="header">
<h1 class="title">flash</h1>
<h4 class="author"><em>Wei Wang &lt;<a href="mailto:weidong@uchicago.edu">weidong@uchicago.edu</a>&gt;, Matthew Stephens &lt;<a href="mailto:mstephens@uchicago.edu">mstephens@uchicago.edu</a>&gt;</em></h4>
<h4 class="date"><em>2016-03-25</em></h4>
</div>


<p>One example for flash and how to use greedy and backfitting. For the speed, I just use backfitting with few runs of flash in each iteration. I also compare with PMD, these are all better than PMD.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;flashr&quot;</span>)
sim_K =<span class="st"> </span>function(K, N, P, SF, SL, signal,noise){
  E =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(N*P,<span class="dv">0</span>,noise),<span class="dt">nrow=</span>N)
  Y =<span class="st"> </span>E
  L_true =<span class="st"> </span><span class="kw">array</span>(<span class="dv">0</span>, <span class="dt">dim =</span> <span class="kw">c</span>(N,K))
  F_true =<span class="st"> </span><span class="kw">array</span>(<span class="dv">0</span>, <span class="dt">dim =</span> <span class="kw">c</span>(P,K))
  
  for(k in <span class="dv">1</span>:K){
    lstart =<span class="st"> </span><span class="kw">rnorm</span>(N, <span class="dv">0</span>, signal)
    fstart =<span class="st"> </span><span class="kw">rnorm</span>(P, <span class="dv">0</span>, signal)
    
    index =<span class="st"> </span><span class="kw">sample</span>(<span class="kw">seq</span>(<span class="dv">1</span>:N),(N*SL))
    lstart[index] =<span class="st"> </span><span class="dv">0</span>
    index =<span class="st"> </span><span class="kw">sample</span>(<span class="kw">seq</span>(<span class="dv">1</span>:P),(P*SF))
    fstart[index] =<span class="st"> </span><span class="dv">0</span>
    
    L_true[,k] =<span class="st"> </span>lstart
    F_true[,k] =<span class="st"> </span>fstart
    
    Y =<span class="st"> </span>Y +<span class="st"> </span>lstart %*%<span class="st"> </span><span class="kw">t</span>(fstart)
  }
  <span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">Y =</span> Y, <span class="dt">L_true =</span> L_true, <span class="dt">F_true =</span> F_true, <span class="dt">Error =</span> E))
}

data =<span class="st"> </span><span class="kw">sim_K</span>(<span class="dt">K=</span><span class="dv">10</span>,<span class="dt">N=</span><span class="dv">100</span>, <span class="dt">P=</span><span class="dv">300</span>, <span class="dt">SF =</span> <span class="fl">0.95</span>, <span class="dt">SL =</span> <span class="fl">0.8</span>, <span class="dt">signal =</span> <span class="dv">1</span>,<span class="dt">noise =</span> <span class="dv">1</span>)
Y =<span class="st"> </span>data$Y
L_true =<span class="st"> </span>data$L_true
F_true =<span class="st"> </span>data$F_true
E =<span class="st"> </span>data$Error
svdl =<span class="st"> </span><span class="kw">svd</span>(Y)$u
svdf =<span class="st"> </span><span class="kw">svd</span>(Y)$v
svdd =<span class="st"> </span><span class="kw">svd</span>(Y)$d
<span class="kw">plot</span>(svdd)</code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAAC+lBMVEUAAAABAQECAgIDAwMEBAQFBQUGBgYHBwcICAgJCQkKCgoLCwsMDAwNDQ0ODg4PDw8QEBARERESEhITExMUFBQVFRUWFhYXFxcYGBgZGRkaGhobGxscHBwdHR0eHh4fHx8gICAhISEiIiIjIyMkJCQlJSUmJiYnJycoKCgpKSkqKiorKyssLCwtLS0uLi4vLy8wMDAxMTEyMjIzMzM0NDQ1NTU2NjY3Nzc4ODg5OTk6Ojo7Ozs8PDw9PT0+Pj4/Pz9AQEBBQUFCQkJDQ0NERERFRUVGRkZHR0dISEhJSUlKSkpLS0tMTExNTU1OTk5PT09QUFBRUVFSUlJTU1NUVFRVVVVWVlZXV1dYWFhZWVlaWlpbW1tcXFxdXV1eXl5fX19gYGBhYWFiYmJjY2NkZGRlZWVmZmZnZ2doaGhpaWlqampra2tsbGxtbW1ubm5vb29wcHBxcXFycnJzc3N0dHR1dXV2dnZ3d3d4eHh5eXl6enp7e3t8fHx9fX1+fn5/f3+AgICBgYGCgoKDg4OEhISFhYWGhoaHh4eIiIiJiYmKioqLi4uMjIyNjY2Ojo6QkJCRkZGSkpKTk5OUlJSVlZWWlpaXl5eYmJiZmZmampqbm5ucnJydnZ2enp6fn5+goKChoaGioqKjo6OkpKSlpaWmpqanp6eoqKipqamqqqqrq6usrKytra2urq6vr6+wsLCxsbGysrKzs7O0tLS1tbW2tra3t7e4uLi5ubm6urq7u7u8vLy9vb2+vr6/v7/AwMDBwcHCwsLDw8PExMTFxcXGxsbHx8fIyMjJycnKysrLy8vMzMzNzc3Ozs7Pz8/Q0NDR0dHS0tLT09PU1NTV1dXW1tbX19fY2NjZ2dna2trb29vc3Nzd3d3e3t7f39/h4eHi4uLj4+Pk5OTl5eXm5ubn5+fo6Ojp6enq6urr6+vs7Ozt7e3u7u7v7+/w8PDx8fHy8vLz8/P09PT19fX29vb39/f4+Pj5+fn6+vr7+/v8/Pz9/f3+/v7///9D8V/AAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAS10lEQVR4nO2deXgURdrAq+/pnjNzJJOLkIscQCAHIQkESAAhnEECCJFbQEA5hEC8UBEkLnJ4oYCLguABuizCuuL3gRd8q6Iru34qHrjK54oKCB4Qkkw9zzedEA+c6Xc60z0zZuv3R6dJvfVWPT8y3dU91dUIExRB4e5ApEMEARBBAEQQABEEQAQBEEEARBAAEQRABAEQQQBEEAARBEAEARBBAEQQABEEQAQBEEEARBAAEQRABAEQQQBEEAARBEAEARBBAEQQABEEQAQBEEEARBAAEQRABAEQQQBEEAARBEAEARBBAEQQABEEQAQBEEEARBAAEQRABAEQQQBEEAARBEAEARBBAEQQABEEQAQBEEEARBAAEQRABAEQQQBEEAARBEAEARBBAEQQABEEQAQBEEEARBAAEQRABAEQQQBEEAARBEAEARBBAEQQABEEoLGghflecrM75+ZHOD3/HUpBb18x4BLi8iNHaiwdEm23Hols0o+GUtCZF1sRH8Lr8z7A+B/Zj2qRWD9yQiroZ0ybmmLel3feSNU2sdaET9CX0S170g/aZtaY8An61two71wwXNQ2s8aETxAu2C3vbOuvbWKtCaOg12PW/+vTu93/1Dax1oRREP74qqTkiZ9pm1dzwinodwERBEAEAegnyHP2lMd/aYugj24ZX/uO2sShRSdBHy1NExDiU5Z87CegWdCDsct2rOxwm6rMoUYfQW9Y4mau2/rY+jlJ1rd8R8iCjrvkU9jpDq+rSR1q9BHUr+93LTsXRpb7jpAFrZ3TvLtysZrUoUYfQZbNrXvPWX1HyIJuWtm8++hkNalDjT6CelS3Hp8XFvqOkAVtrm7eXbJcTepQo4+gp6n+mw699/7hPw6jd/qOkAV9E/08xmf/4jquJnWo0ekstrcMNVO2109A81nsUFrPGI62P6gwHAg7uo2Dvjm6f/8731z2y/qf7mRKzeOgA9ZJ1+dwXMD3fcOAriPpi+cu+8UrP90Lp++W/z1o25Ki1+qPGDpcbjJy0EnQvgmjn/As4VHHLX4+Pi0jaec7zlPeH93H3qwqeyjRR9AOlF5umGOo3TgBKRykMY5++Er5R+dHStVkDyn6COpW1Yi3o1XevakKp3mMq6aM8W7fjTlYoiZ7SNFHkPgkxifRK969HSbfES2C/jfKfOKHLc6p1QvUZA8p+gjqsBrjhlVfePfWJPiOuHS741gqz3OFRVz342rShxJ9BF1v29D8pVfDgZgpviNa7wc1zKLd5ooP13ZrVJM/hOgj6Fw16iv/7IxKvvQd8dMNswkbP//xxL4D3V5Tkz+E6DUOOnNM3j5xqMlP+U+Cig/Xz3cPLRenq8sfMsJ+y3XYM3NHn350oGio0bYBrQi7oM2llm8ry+533SjN0rYFjQi7oKbB4oLUm2MWT+Ych7VtQhvCLggfi8nKui5v4CpbmuNf2rahCeEX5Emp2DxlIa4ZdmXXodq2oQnhF4RfMnU37hop5CR0oh7XthEtiABB+C2J6mNbN5VPYKlxETdZKBIE4WO8PcopPDSFiucsf9a2naCJCEH4pk5jBm+sSrvmDyksP/lv2rYUJJEh6EKRyVLJjJhvt4qxbNykC9q2FRQqBTl+QRtaOzqmFXbtrwpORLmu6rUn2zq8qNbIuke2IbVeqBS0YcOG9dbERWtrkpL3taG1r55uxbDh1yUPiN07F0fzb4vxbhOPTJt91w8D6j9ic0rOe7cXes0Oqt3fTH85aGScs2JcjkGWkVUUYvJPBpVeO9QLit/S/GNLXFDt/nZ+0MlBtIEZ1FncmphhzeYQtyYy7hCpFxS7ovnH8sSg2vU1gWqHaDQPFtcwlVLlNRm93TcE1YBWqBc0XdrVhJt2isFdfPucYbbJJRlpky2hZnIlHWdgdgXVgkaoF3SuHzJnmNGA74Nq1/cUvK82SdYu/QtuN3aPm28X2OlfB9WGJrRhHOQ5uHrR2mDvkPqbo/h2FsMZUgxx3eKzeRcj3ujvjmTIiIyB4i9o2htNs5blHW3F9pk0xaTuD7Oi0A4Uf0Zhlmv9Yorhcmw5HQfYJBeF6LjKTR8G1VZQhHag+DOK04Df5VmeXtB5lL17giCKDCNYl4Rthox+A8VApgH7Y6utn7SghL+Xm0cXpdrnjXD2uD/AbmqOTgPFwKYB+2ePwJpyHSPNuV3E8fndWIFmJ34eYEc1Rp+BYmDTgJU40pXhmI4JhjrLem4Ul56HaKrg7QC7qin6DBQDmwasiOdovMElDu3FzDJnFTsK7ZKNpyeeD7CzGqLPQDGwacAA3y/laMrg5Eup+VyVaWYpJVJMsb85j7qhz0AxsGnAIA33FfAISZQ11r6+IMWQk8FQlO2Oy+f16Yt6QTNehodugU0DDoh3p5uFzNLMl5hr2flipjWaY6TaUF7nqxcUhxJrwccoA5sGHBhjOiXHpKXGxA41zeBqTFG5Jsb1QsCVg0a9oKbDi5JRt9XQWdfnNODGT1oxBi6oaUM8RRm5pFLmJmGWucrC9InnKz8NuHqQtOlazPP2zZlUmWJ4w/GWb7i+/9UU6AMprbRMAw6Ur2ZxSMo2W8bar+Tv5hwmRNGGHhuCu58QIG27WD29fSzPKAQ33iEifoH8QPxqPxe5ap84PHsFS3OD8qnB5nu4/ARbtIVhabbv8/ofjdog6NN7+7NcxSNKc7/XU/N2LmDkZ1W0EoTxX7sxFM10LRGn0CuZmUaXye39N3e33orUC+qG+OGPnVYOzp7r3WxBz2opyHsw2hRNUaLLHlvUydVPmEEPr3E4k/WeH6te0KjtZ8Fg8Ql5OzrlvKaCvPw9ixZLJfst9MK4fGttOhPNosRtul7pt+UY5O3Qh/sU74ZmNP+/fm6b5tFYEMabjUZDV4mdJ9lGOCroPkU2RsjR81kY9YI+GzgNv8CgqCMKwfdQM3f/iPFTaPpsrQXhsxluoxgjuNkJ7Dj7NCmxWERU2jX79RpfqxdUGb8b9y37pO9gheCGVTYkT5R+OhppLgg3bOxlpLzneVuKUMOu4otFp4kWxJjn2pxQEfWCotbic/Sz+CHlW66eE81X3vX/tdF3eZALCzQ8X8xRnNMiuZMr3Y4RJpdEMaVr3g0qp2/UC7I+jP/EnMabjEG1G/zKC/WPcDxjGHeXYYLhOarUzhhomrUM/POPwea9DPWCBvY81KMcnyrLD6pdLZam2OeyCP1SqcKOo2OSC5irBV4w84b454NP/EvUC3onBkmv4VQ+uM+8Jmt3fD5TogS6d5lQYxjOZ+cIV+U4OIrOu+GvGn5V1IbT/A9vfoXxro+Ca1ejxU08t9BGMx1XYUwtYqa776J72WiO5czxWzXJLhNxXxyq5eNhLI2MrCNRWCKVJJqH0kutrMtNd9dq4abfvSD5mau5HJecYk/qIozj+tsyShJNCSJNOYbWabGwTDsQ5OW9YpqhTDTryrJOYDZz87iuJp5iGDF5R9Cp24cgjE+tqXDQlIWJtjsXGjK6C9XUUJPFkWroF+yE0PYiSOarGw1Cl3SLo5K6ylDkdlVajW6WYoafCCppexKE8ZtdvR81SaDMI4zj7bX0DCGrN4NQ1IRjbU8ZWkHvzWyFW6dFvt/y9cNVEm0usdgX8ldaYytMhWxiP5HnF7V5ZBRaQV883IrhAS3y+aTxWoET0gW7cSJ9jdA3ZYCJc4lIGO/nO3CI9vURu8TJRTaKpoyiYLyarROWUb2iBZcoVtS3JVe7FOTl+MpSnmHTjNw9wih7emFylIVGVNZL6hO1V0FeGoeYzAnxxgJxPr+cmsvn96EpxCbdqHIaTTsWhPELPSmWYZJ6SWk94ipceXSyk+VoKvkZNTnatSCMv5xuRJSR7ryYuo8tj4ktoztMk0zmcSoytHNBXv6RT0sWq5DeRbo6aiR3l9U6JJkpDPxL2fYvCOM9GRRFJUSJKw25cV1z87pwEsWkzf2fwCr/JwjC+MwAiTdnmmINS7jldBXfUeI4io7dFMhi8f8ZgjB+dQhLUUx+ptAp0zWcuY9KzmB4mit6AHxUP7yrAYeS+jtdCFEoOYYpiZ5i7ZEmOhze0SQSKt5QrBbW1YBDztFqno5Cvadaq8Ux/ECXvVMcHWVm8z9QqBLO1YDDwdddBWdfMepBqb8kllum8BUJnJFGro1+L2bDuRpweOjrtERlx9mcA5nJUnoH52B64ACWol33+/lCLZyrAYeHpo2pNE1RVolP6y6Msg5jp5jcpliOdfgeYIdzNeCwcf7wdO/lPpPuZMdKSb2F+fSaOMHKIPOsM7+NDedqwGHlxTyG5g2Cw1AmjHZNjUrMsjhpjlnxmxNvWFcDDi+n/ljW/Dia3XCzMIvZRlXlUSY2+sBlUaFdDdhzupUIECRzfqrAMoUuJrNzSWZWdkyZhJjRv55hHNqR9IGoVmj9brmq4+RiC0WjiiHM7fTf6AHxgpuh4+ft/7k8XJcaRQFeK4YAz71miuEslq5jo7NyvNe0tJG35P50CUIEyTxhlEwlCfwV9BZ6snlsR5ZjqdyXW4r0EbToF/iOiCxB+MzNCYii82Kiy22TXIOpbpUcI1Q1z5HTR9DiKGRPvYTviAgT5OWTbt6hUb9e1E5hAj9PjBnfl0+XFwPX6SP2IbNaOSDyBGH8jIGxZrs7J8UPNl9r68sY2ILv9TsGlfwOBeHPBlIUE+0W5jK3iaOHX3mXucyjm6CXgUfKIlKQ96RfbeQoo2iNHjlgU/xhd+6L5Cx2ORcP9Bd4viR9+MRxe8pr7yKCfPDuEIZ2O657K2334joiyCfnCrkrymK31Xd6lQjyTX3nQdtP/31IVRhH0nPq6laWVCjSp49yecEgxeIBxcrVi/srVU6RqOjhK+vq3GES9OjSpUtn80WKJCQol/O5isWZNuXq9k6KxfncUpla+Ok4XQTJ/B+wkN7twNsP45VnH+4bolx91LOKxV87latfDhEEQAQBEEEARBAAEQRABAEQQQA6CDrZQbl8BfAC1iQ/L1a6xAsjlKuP2aNYfMatXP1ydBCEgVc//gi8IgGo3gSsn3EGWPZD5Ysp9RDUriCCAIggACIIgAgCIIIAiCAAIgiACAIgggCIIAAiCEB7QTt7Wsvf9FnSuCZL6nJfo1JMU3m1/xz/HG7vsLzJb3HD6k5S7lPKXVCP5oL20hM2lVp9LkO0ipq3YzZ1h1LMg6jab44PnEM2z0Z1fqvfxtRsq0bPKXZBPZoLKiv34HOxS32UeKJmeLfXiw3+Y46bTNV+c8zo4/3jWzTabxNxs7xtFFQqdaENaC3oGySvjzczzUfRCbTbu92JjvuNaSqb2KvaX44L5u24UaEJj/NW73bYYKUutAGtBR1Fh7zbdYKPh+7Ovy8/ebOA/8FvzAPuU7Ig3+WfoO2lfPztDX6bWBDzyrdPctuUutAGtBa0H73n3W5F/r763sLM9xtz3Lgby4J8l7+GpMX7lrHL/FZvKEQIzYG7oA7tBclLdT6GfN/YPFGFJtT7i2kq88ppEeSrfC9a6N0ukBr8VPeMdj98cKWhDuiCWrQW9A6SXw6+nvf59/20LeVZ/zGPRH185kzPMWcu+i5/Hb3o3e5BH/qp/jKSl8RfwX+r2AXVaH+Qll+BMzfFV9lONO28QsyilieJ0J98l38mn8HxM+gLP9UfQ/JKxn9B7yl1QT2an+b7DfOecDrW+Cipj57uUYr5+KCXLgMOfu273JMz3ru9OsHjp/qbSH62sJavV+hCG9B+oEjdsLfS6uup6P9Gs1fLfK8Q03wM8lO+HU16fBp63F+xp8Ky4snrmWVKXWgD2l9qPFVgKfO5KPXGSx+hfyvEtAjyU76thylvp//i72rTxS4PNCp1oQ2Qi1UAIgiACAIgggCIIAAiCIAIAiCCAIggACIIgAgCIIIAiCAAIgiACAIgggCIIAAiCIAIAiCCAIggACIIgAgCIIIAiCAAIggg8gRtQJe/43mD8stx9YUIAiCCACJTUNK21VmWMacwPjcjPn7ueq8gz+Y8qet2jA/I88x2slq8KDMwIlRQrxH77uPnYE8/6c4txVavoDXouicnoa0YT00/fzbultB1J0IFZTZiPLkQH0S7MD6f6MDfWeUJY1enYvyN6/b5medD150IFSTrWJqPV5vlRzMWOfDrSF7h8jn6IsbbefZQCLsToYL+gJsFLcqQf7PWgXchXhAEDn2K8UVnpoYvxQaJUEHykrFeQWub/4JqHPg19NL7Mt7PVl2MEMp14SNb0KvyMehCkgOfFuVXejw+yYOPCU8tizoZuu5EtiBPf+nOx3one89it0rLnl5qWIGbSq/w/Jg8MXTdiWxB+LsZCbGz98njoHVdxMx1Hvyg8JH8VMKBkHUn8gRFGEQQABEEQAQBEEEARBAAEQRABAEQQQBEEAARBEAEARBBAEQQABEEQAQBEEEARBAAEQRABAEQQQBEEAARBEAEARBBAP8PrcbELkVhbMcAAAAASUVORK5CYII=" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">svdK =<span class="st"> </span><span class="dv">10</span>
<span class="kw">sqrt</span>(<span class="kw">mean</span>(((Y  -<span class="st"> </span>svdl[,<span class="dv">1</span>:svdK]%*%<span class="st"> </span><span class="kw">diag</span>(svdd[<span class="dv">1</span>:svdK]) %*%<span class="st"> </span><span class="kw">t</span>(svdf[,<span class="dv">1</span>:svdK]) )-<span class="st"> </span>E)^<span class="dv">2</span>)) /<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">mean</span>(((Y -<span class="st"> </span><span class="dv">0</span>)-<span class="st"> </span>E)^<span class="dv">2</span>))</code></pre></div>
<pre><code>## [1] 1.383</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#sqrt(mean(((Y  - svdd[1] * svdl[,1] %*%  t(svdf[,1]) )- E)^2)) / sqrt(mean(((Y - 0)- E)^2))</span>
ggreedy =<span class="st"> </span><span class="kw">greedy</span>(Y,<span class="dt">K=</span><span class="dv">30</span>)
<span class="co"># initial gl and gf as svd</span>
gl =<span class="st"> </span>ggreedy$l
gf =<span class="st"> </span>ggreedy$f
<span class="kw">dim</span>(gl)</code></pre></div>
<pre><code>## [1] 100   9</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sqrt</span>(<span class="kw">mean</span>(((Y  -<span class="st"> </span>gl%*%<span class="kw">t</span>(gf) )-<span class="st"> </span>E)^<span class="dv">2</span>)) /<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">mean</span>(((Y -<span class="st"> </span><span class="dv">0</span>)-<span class="st"> </span>E)^<span class="dv">2</span>))</code></pre></div>
<pre><code>## [1] 0.528</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># proportion in </span>
eigenvalue =<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>,<span class="kw">dim</span>(gl)[<span class="dv">2</span>])
for(i in <span class="dv">1</span>:<span class="kw">length</span>(eigenvalue)){
  eigenvalue[i] =<span class="st"> </span>(<span class="kw">sqrt</span>(<span class="kw">mean</span>((gl[,i]%*%<span class="kw">t</span>(gf[,i]))^<span class="dv">2</span>)))
}
eigenvalue =<span class="st"> </span>eigenvalue /<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">mean</span>(Y^<span class="dv">2</span>))
<span class="kw">plot</span>(eigenvalue)</code></pre></div>
<p><img src="data:image/png;base64,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" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gback =<span class="st"> </span><span class="kw">backfitting</span>(Y,gl,gf, <span class="dt">maxiter_r1 =</span> <span class="dv">10</span>)
gbl =<span class="st"> </span>gback$l
gbf =<span class="st"> </span>gback$f
<span class="kw">dim</span>(gbl)</code></pre></div>
<pre><code>## [1] 100   9</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sqrt</span>(<span class="kw">mean</span>(((Y  -<span class="st"> </span>gbl%*%<span class="kw">t</span>(gbf) )-<span class="st"> </span>E)^<span class="dv">2</span>)) /<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">mean</span>(((Y -<span class="st"> </span><span class="dv">0</span>)-<span class="st"> </span>E)^<span class="dv">2</span>))</code></pre></div>
<pre><code>## [1] 0.5111</code></pre>
<p>The comparing criterion is <span class="math display">\[\frac{RMSE - RMSE_{opt}}{RMSE_{naive}}\]</span></p>
<p>If we know the variance, we can do better based on our model.</p>
<p>we can see that if we known the variance matrix, we can do better than using flash with constant variance. I have also compared those with PMD, and the result is flash_hd better then flash which is better then PMD.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim_hd =<span class="st"> </span>function(N, P, SF, SL, signal, <span class="dt">a =</span> <span class="kw">rchisq</span>(N,<span class="dv">3</span>),<span class="dt">b =</span> <span class="kw">rchisq</span>(P,<span class="dv">1</span>),<span class="dt">mu =</span> <span class="dv">0</span>){

  E =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rep</span>(<span class="dv">0</span>,N*P),<span class="dt">nrow=</span>N)
  sig2_true =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rep</span>(<span class="dv">0</span>,N*P),<span class="dt">nrow=</span>N)
  for(i in <span class="dv">1</span>:N){
    for(j in <span class="dv">1</span>:P){
      sig2_true[i,j] =<span class="st"> </span>mu +<span class="st"> </span>a[i] +<span class="st"> </span>b[j]
      E[i,j] =<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="kw">sqrt</span>(mu +<span class="st"> </span>a[i] +<span class="st"> </span>b[j]))
    }
  }
  
  K=<span class="dv">1</span>
  lstart =<span class="st"> </span><span class="kw">rnorm</span>(N, <span class="dv">0</span>, signal)
  
  fstart =<span class="st"> </span><span class="kw">rnorm</span>(P, <span class="dv">0</span>, signal)
  
  index =<span class="st"> </span><span class="kw">sample</span>(<span class="kw">seq</span>(<span class="dv">1</span>:N),(N*SL))
  lstart[index] =<span class="st"> </span><span class="dv">0</span>
  index =<span class="st"> </span><span class="kw">sample</span>(<span class="kw">seq</span>(<span class="dv">1</span>:P),(P*SF))
  fstart[index] =<span class="st"> </span><span class="dv">0</span>
  
  Y =<span class="st"> </span>lstart %*%<span class="st"> </span><span class="kw">t</span>(fstart) +<span class="st"> </span>E
  
  <span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">Y =</span> Y, <span class="dt">L_true =</span> lstart, <span class="dt">F_true =</span> fstart, <span class="dt">Error =</span> E,<span class="dt">sig2_true =</span> sig2_true))
}
<span class="kw">library</span>(<span class="st">&quot;flashr&quot;</span>)
N =<span class="st"> </span><span class="dv">100</span>
P =<span class="st"> </span><span class="dv">200</span>
SF =<span class="st"> </span><span class="fl">0.5</span>
SL =<span class="st"> </span><span class="fl">0.5</span>
signal =<span class="st"> </span><span class="dv">1</span>
data =<span class="st"> </span><span class="kw">sim_hd</span>(N, P, SF, SL, signal, <span class="dt">a =</span> <span class="kw">rchisq</span>(N,<span class="dv">3</span>),<span class="dt">b =</span> <span class="kw">rchisq</span>(P,<span class="dv">1</span>),<span class="dt">mu =</span> <span class="dv">0</span>)
sigmae2_true =<span class="st"> </span>data$sig2_true
Y =<span class="st"> </span>data$Y
E =<span class="st"> </span>data$Error
ghd =<span class="st"> </span><span class="kw">flash_hd</span>(Y,<span class="dt">partype =</span> <span class="st">&quot;known&quot;</span>,<span class="dt">sigmae2 =</span> sigmae2_true)
l =<span class="st"> </span>ghd$l
f =<span class="st"> </span>ghd$f
<span class="kw">sqrt</span>(<span class="kw">mean</span>(((Y -<span class="st"> </span>l %*%<span class="st"> </span><span class="kw">t</span>(f))-E)^<span class="dv">2</span>))/<span class="kw">sqrt</span>(<span class="kw">mean</span>((Y -<span class="st"> </span>E)^<span class="dv">2</span>))</code></pre></div>
<pre><code>## [1] 0.3669</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ghd =<span class="st"> </span><span class="kw">flash_hd</span>(Y,<span class="dt">partype =</span> <span class="st">&quot;constant&quot;</span>)
l =<span class="st"> </span>ghd$l
f =<span class="st"> </span>ghd$f
<span class="kw">sqrt</span>(<span class="kw">mean</span>(((Y -<span class="st"> </span>l %*%<span class="st"> </span><span class="kw">t</span>(f))-E)^<span class="dv">2</span>))/<span class="kw">sqrt</span>(<span class="kw">mean</span>((Y -<span class="st"> </span>E)^<span class="dv">2</span>))</code></pre></div>
<pre><code>## [1] 0.5266</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gvem =<span class="st"> </span><span class="kw">flash_r1</span>(Y)
l =<span class="st"> </span>gvem$l
f =<span class="st"> </span>gvem$f
<span class="kw">sqrt</span>(<span class="kw">mean</span>(((Y -<span class="st"> </span>l %*%<span class="st"> </span><span class="kw">t</span>(f))-E)^<span class="dv">2</span>))/<span class="kw">sqrt</span>(<span class="kw">mean</span>((Y -<span class="st"> </span>E)^<span class="dv">2</span>))</code></pre></div>
<pre><code>## [1] 0.527</code></pre>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
